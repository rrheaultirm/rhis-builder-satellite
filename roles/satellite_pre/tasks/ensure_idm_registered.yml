---

- name: "Ensure /etc/hosts"
  ansible.builtin.lineinfile:
    path: "/etc/hosts"
    line: "{{ ipa_client_dns_servers }}    {{ ipa_server_fqdn }}"
  tags:
    - tags_satellite_pre
    - tags_satellite_pre_idm_integration
    - tags_satellite_before_sync

- name: "Ensure idm server is our DNS resolver"
  ansible.builtin.lineinfile:
    path: "/etc/resolv.conf"
    line: "nameserver {{ ipa_client_dns_servers }}"
  tags:
    - tags_satellite_pre
    - tags_satellite_pre_idm_integration
    - tags_satellite_before_sync

# role will install client
- name: "Ensure the client configuration"
  ansible.builtin.include_role:
    name: "redhat.rhel_idm.ipaclient"
  tags:
    - tags_satellite_pre
    - tags_satellite_pre_idm_integration
    - tags_satellite_before_sync
